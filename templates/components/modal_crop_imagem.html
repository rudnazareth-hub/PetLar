{#
Componente: Modal de Crop de Imagem Reutilizável

Parâmetros esperados:
- modal_id: ID único do modal (ex: "modalFotoPerfil")
- modal_title: Título do modal (ex: "Alterar Foto de Perfil")
- form_action: URL para onde o formulário será enviado (ex: "/perfil/atualizar-foto")
- aspect_ratio: Proporção do crop (ex: 1.0 para 1:1, 1.777 para 16:9) - default: 1.0
- max_file_size_mb: Tamanho máximo do arquivo em MB (default: 5)
- accepted_formats: Formatos aceitos (default: ".jpg,.jpeg,.png,.gif,.webp")
- show_upload_section: Se deve mostrar seção de upload dentro do modal (default: true)

Exemplo de uso:
- Defina as variáveis antes do include:
set modal_id = "modalFotoPerfil"
set modal_title = "Alterar Foto de Perfil"
set form_action = "/perfil/atualizar-foto"
set aspect_ratio = 1.0
set show_upload_section = false # Para usar input externo
- Depois faça: include 'components/modal_crop_imagem.html'
#}

{% set aspect_ratio = aspect_ratio if aspect_ratio is defined else 1.0 %}
{% set max_file_size_mb = max_file_size_mb if max_file_size_mb is defined else 5 %}
{% set accepted_formats = accepted_formats if accepted_formats is defined else ".jpg,.jpeg,.png,.gif,.webp" %}
{% set show_upload_section = show_upload_section if show_upload_section is defined else true %}

<div class="modal fade" id="{{ modal_id }}" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-crop"></i> {{ modal_title }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ form_action }}" method="post" id="form-{{ modal_id }}">
                <div class="modal-body">
                    <!-- Seleção de arquivo (opcional, baseado no parâmetro show_upload_section) -->
                    {% if show_upload_section %}
                    <div class="mb-3" id="upload-section-{{ modal_id }}">
                        <label for="input-{{ modal_id }}" class="form-label">Selecione uma imagem:</label>
                        <input type="file" class="form-control" id="input-{{ modal_id }}"
                            accept="{{ accepted_formats }}" required>
                        <div class="form-text">
                            Formatos: JPG, PNG, GIF, WEBP. Tamanho máximo: {{ max_file_size_mb }}MB
                        </div>
                    </div>
                    {% endif %}

                    <!-- Container do Cropper -->
                    <div id="cropper-container-{{ modal_id }}" class="{% if show_upload_section %}d-none{% endif %}">
                        <!-- Área da imagem com altura calculada dinamicamente pelo JS -->
                        <div id="cropper-image-area-{{ modal_id }}" class="mb-3 overflow-hidden">
                            <img id="cropper-image-{{ modal_id }}" src="" alt="Imagem para crop" class="mw-100 d-block">
                        </div>

                        <!-- Área de controles: Preview à esquerda, Botões à direita -->
                        <div id="cropper-controls-area-{{ modal_id }}"
                            class="d-flex align-items-start gap-3 pt-3 border-top">
                            <!-- Preview à esquerda -->
                            <div class="flex-shrink-0 text-center">
                                <div class="border border-2 border-dark preview-120">
                                    <img id="preview-{{ modal_id }}" src="" alt="Preview"
                                        class="w-100 h-100 object-fit-cover">
                                </div>
                            </div>

                            <!-- Botões à direita em uma única linha -->
                            <div class="flex-grow-1 d-flex justify-content-end align-items-start gap-3 mt-auto">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancelar
                                </button>
                                <button type="submit" class="btn btn-primary" id="btn-submit-{{ modal_id }}" disabled>
                                    <i class="bi bi-upload"></i> Salvar Foto
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Campo hidden com imagem cropada em base64 -->
                    <input type="hidden" name="foto_base64" id="foto-base64-{{ modal_id }}">
                </div>

                <!-- Footer vazio: botões foram movidos para a área de controles do cropper -->
                <div class="modal-footer d-none"></div>
            </form>
        </div>
    </div>
</div>

<script>
    // Configuração específica deste modal
    window['config_{{ modal_id }}'] = {
        modalId: '{{ modal_id }}',
        aspectRatio: {{ aspect_ratio }},
    maxFileSizeMB: { { max_file_size_mb } }
    };
</script>