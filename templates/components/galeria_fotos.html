{#
  Componente de Galeria de Fotos Reutilizável

  Parâmetros:
  - images: Lista de dicionários com as chaves:
    - url: URL da imagem
    - alt: Texto alternativo da imagem
  - gallery_id: ID único para a galeria (opcional, padrão: 'photoGallery')
#}

{% macro galeria_fotos(images, gallery_id='photoGallery') %}
<div class="photo-gallery" id="{{ gallery_id }}">
    <!-- Imagem Principal -->
    <div class="ratio ratio-1x1 mb-3">
        <img id="{{ gallery_id }}-main"
             src="{{ images[0].url }}"
             class="img-fluid rounded shadow"
             alt="{{ images[0].alt }}"
             data-gallery-main>
    </div>

    <!-- Galeria de Miniaturas -->
    <div class="row g-2">
        {% for image in images %}
        <div class="col-3">
            <div class="ratio ratio-1x1">
                <img src="{{ image.url }}"
                     class="img-fluid rounded border {% if loop.index0 == 0 %}border-primary border-2{% endif %} gallery-thumbnail"
                     alt="{{ image.alt }}"
                     role="button"
                     data-gallery-thumbnail
                     data-gallery-index="{{ loop.index0 }}"
                     tabindex="0">
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .gallery-thumbnail {
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .gallery-thumbnail:hover {
        opacity: 0.8;
        transform: scale(1.05);
    }

    .gallery-thumbnail:focus {
        outline: 2px solid var(--bs-primary);
        outline-offset: 2px;
    }
</style>

<script>
    // Inicializar galeria quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', function() {
        const gallery = document.getElementById('{{ gallery_id }}');
        if (!gallery) return;

        const mainImage = gallery.querySelector('[data-gallery-main]');
        const thumbnails = gallery.querySelectorAll('[data-gallery-thumbnail]');

        thumbnails.forEach(thumbnail => {
            // Clique na miniatura
            thumbnail.addEventListener('click', function() {
                // Atualizar imagem principal
                mainImage.src = this.src;
                mainImage.alt = this.alt;

                // Atualizar bordas das miniaturas
                thumbnails.forEach(thumb => {
                    thumb.classList.remove('border-primary', 'border-2');
                    thumb.classList.add('border');
                });

                this.classList.add('border-primary', 'border-2');
            });

            // Suporte para teclado (Enter e Space)
            thumbnail.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });
    });
</script>
{% endmacro %}
